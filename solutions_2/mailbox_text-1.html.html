<p>```ruby</p>

<h1>You will probably have found a solution that looks a little bit different</h1>

<h1>from the one below.</h1>

<h1>Here is a step by step refactoring from one solution from our groups:</h1>

<h1>https://gist.github.com/svenfuchs/308e5f7f32b6e4920619</h1>

<h1>Try understand each of the steps, and how it leads to the solution below.</h1>

<p>class Email
  def initialize(subject, headers)
    @subject = subject
    @headers = headers
  end</p>

<p>def subject
    @subject
  end</p>

<p>def date
    @headers[:date]
  end</p>

<p>def from
    @headers[:from]
  end
end</p>

<p>class Mailbox
  def initialize(name, emails)
    @name = name
    @emails = emails
  end</p>

<p>def name
    @name
  end</p>

<p>def emails
    @emails
  end
end</p>

<p>class MailboxTextFormatter
  def initialize(mailbox)
    @mailbox = mailbox
  end</p>

<p>def format
    lines = [
      separator,
      format<em>row([&quot;Date&quot;, &quot;From&quot;, &quot;Subject&quot;]),
      separator,
      rows.collect { |row| format</em>row(row) },
      separator,
    ]
    lines.join(&quot;\n&quot;)
  end</p>

<p>def separator
    &quot;+#{column_widths.map { |width| &#39;-&#39; * (width + 2) }.join(&quot;+&quot;)}+&quot;
  end</p>

<p>def format<em>row(row)
    cells = 0.upto(row.length - 1).map do |ix|
      row[ix].ljust(column</em>widths[ix])
    end
    &quot;| #{cells.join(&quot; | &quot;)} |&quot;
  end</p>

<p>def emails
    @mailbox.emails
  end</p>

<p>def column<em>widths
    columns.map { |column| column.max</em>by { |cell| cell.length }.length }
  end</p>

<p>def columns
    rows.transpose
  end</p>

<p>def rows
    emails.collect { |email| [email.date, email.from, email.subject] }
  end
end</p>

<p>emails = [
  Email.new(&quot;Homework this week&quot;, { :date =&gt; &quot;2014-12-01&quot;, :from =&gt; &quot;Ferdous&quot; }),
  Email.new(&quot;Keep on coding! :)&quot;, { :date =&gt; &quot;2014-12-01&quot;, :from =&gt; &quot;Dajana&quot; }),
  Email.new(&quot;Re: Homework this week&quot;, { :date =&gt; &quot;2014-12-02&quot;, :from =&gt; &quot;Ariane&quot; })
]
mailbox = Mailbox.new(&quot;Ruby Study Group&quot;, emails)
formatter = MailboxTextFormatter.new(mailbox)</p>

<p>puts formatter.format
```</p>
